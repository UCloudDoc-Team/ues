# 创建集群
本节旨在引导新用户快速上手创建实例。

登录控制台，在 **产品与服务** 寻找 **大数据** 大类下 **ES服务 Elasticsearch** 进入[产品创建页](https://console.ucloud.cn/ues/create)。

页面会列出可创建服务的全部地域和可用区，选择需求的可用区、服务版本、磁盘类型、节点类型、磁盘大小、节点数量、填写一些初始化信息等内容后创建就可实现服务集群的快速部署。

## 地域及基础配置
创建 UES 集群时需先选择部署地域及可用区。UES 支持单可用区、双可用区及三可用区部署模式，建议根据业务对可用性与容灾能力的要求选择合适的可用区部署方式。详情可参考[多可用区部署](/ues/operate/cross_zone.md)。

![image](/images/create_es_0115.png)


## 节点配置

### 集群类型选择

**基础类型** ![images](/images/create_cluster_base_1.png) 


**专有主节点** ![image](/images/create_cluster_master_1.png)


**协调节点** ![image](/images/create_cluster_coordinating_1.png)

初始创建可以选择集群类型：

\* 基础类型为集群没有单独master节点的情况，即所有节点配置为：

\`node.master: true\`

\`node.data: true\`

\* 专有主节点类型为集群设置有单独master节点的情况

master节点配置为：

\`node.master: true\`

\`node.data: false\`

data节点配置为：

\`node.master: false\`

\`node.data: true\`

\* 协调节点类型为集群设置有单独协调节点的情况

协调节点配置为：

\`node.master: false\`

\`node.data: false\`

如果您的集群是需求较多的节点数和较高的节点配置，推荐考虑选用主节点分离类型。这样即保证主节点选用较低的配置来避免资源浪费，又保证数据节点选用较高配置来提高数据处理能力。其中主节点分离类型主节点个数为3个，节点个数5-20个时选用的主节点配置为2核8G，节点个数大于20个时选用的主节点配置为4核8G。

值得注意的是，基础类型暂不支持添加主节点。

### 节点规格、节点数量选择以及付费方式

![image](/images/create_node_type_1.jpg)

**其中可选的节点规格**

按磁盘、规格分类：

| 磁盘类型      | 标识   |
| ------- | ---- |
| RSSD云盘  | o.es |
| SSD云盘  | n.es |

可选节点规格详细配置（最新节点参考“UES价格”导航页）：

| 机型    | 名称           | 配置                 |
| ----- | ------------ | ------------------ |
| 内存密集型 | o.es4m.medium   | 2核 8G  |
| 内存密集型 | o.es4m.xlarge  | 4核 16G  |
| 内存密集型 | o.es4m.2xlarge | 8核 32G  |
| 内存密集型 | o.es4m.4xlarge | 16核 64G  |
| 普通机型  | o.es2m.medium  | 2核 4G  |
| 普通机型  | o.es2m.xlarge | 4核 8G  |
| 普通机型  | o.es2m.2xlarge  | 8核 16G  |
| 普通机型  | o.es2m.4xlarge  | 16核 32G |
| 普通机型  | o.es2m.8xlarge  | 32核 64G |

**计算规格**

选择计算规格前，您需要先注意到UES节点的磁盘空间，然后关注集群主要用于存储哪些数据、数据增量等信息，选择合适的磁盘大小对应的节点规格。

**磁盘大小**

Elasticsearch 服务存储容量的主要因素如下：
- 副本数量：副本有利于增加数据的可靠性，但同时会增加存储成本。默认和建议的副本数量为1，对于部分可以承受异常情况导致数据丢失的场景，可考虑设置副本数量为0。
- 数据膨胀：除原始数据外，ES 需要存储索引、列存数据等，在应用编码压缩等技术后，一般膨胀10%。
- 内部开销：ES 占用约20%的磁盘空间，用于 segment 合并、ES Translog、日志等。
- 操作系统预留：默认操作系统会保留5%，用于关键流程处理、系统恢复、防止磁盘碎片化问题等。
- 安全阈值：通常至少预留15%的安全阈值。

因此，数据在 Elasticsearch 中占用的实际空间可通过下面公式估算：
```
磁盘总大小 = 源数据 × (1 + 副本数量) × (1 + 数据膨胀) / (1 - 内部任务开销) / (1 - 操作系统预留) /（1 - 安全阈值）
         = 源数据 × (1 + 副本数量) × 1.7
```

**节点数量**

节点数量选择与索引分片、数据冗余、容错转移、故障恢复、处理效率等有密切的关系。如果您对Elasticsearch已经有了深刻的领悟和熟练的使用，想必可以做出合理的节点配置和个数选择；如果您对Elasticsearch还处于了解阶段，可以根据实际的业务需求、处理数据的量级合理分析选择。

为了保证集群的高可用性，基础类型集群默认最少3个节点，主节点分离类型集群默认主节点为3个，最少数据节点为2个。

创建成功，后续集群可以扩容节点（不支持主节点创建和扩容）。

**计费选择**

计费模式分为按时、月付、年付3种类型。控制台支持计费类型修改。

## 安全组

![image](/images/create_secgroup_1.png)

初始创建可以选择 1 到 5 个安全组；也可以不绑定安全组，使用默认防护墙。


## Kibana账号密码设置

![image](/images/create_kibana_passwd_1.jpg)

Kibana是一个开源的分析与可视化平台，是Elasticsearch比较常用的管理工具。您可以用kibana搜索、查看、交互集群中的索引数据，使用各种不同的图表、表格、地图等kibana能够很轻易地展示高级数据分析与可视化。

Kibana让我们理解大量数据变得很容易。

产品默认开启kibana服务，并添加了权限验证。需要在创建集群的时候设置账号密码。

## 后续操作

1. 确认支付：集群信息选择和填写完成后点击创建，到支付确认页面，完成支付创建。
2. 集群部署：等待部署中，由于集群规模不同，所需要的部署时间会有所差异，部署大致时间在2分钟到5分钟。部署中，列表的集群的集群状态会显示为"蓝色"状态创建中，创建成功后集群状态会动态变化为"绿色"状态运行。如果长时间为创建状态，可点击刷新重新获取集群状态。

![image](/images/create_ues_list_1.jpg)

